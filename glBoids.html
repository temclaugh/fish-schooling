<!doctype html>
<html>
<head>
<title>webGL_boids</title>
  <script src="three.js" ></script>
  <script src="FirstPersonControls.js" ></script>
  <script src="ColladaLoader.js" ></script>
  <script src="kdTree-min.js"></script>
  <script src="boids.js"> </script>
  <script type="text/javascript">



  var numBoids = 20;
  var lastMouseX = 0;
  var lastMouseY = 0;

  var loader = new THREE.ColladaLoader();

  function draw3D()  {
    var controls;

    function animate() {

      //var boidTree = initTree(boids);
      //boids = nextGeneration(boids);

      requestAnimationFrame(animate);
      for (var i = boids.length - 1; i >= 0; i--) {

          boids[i].rotateY((Math.random() - .5)/40);
          boids[i].rotateX((Math.random() - .5)/40);
          boids[i].rotateZ((Math.random() - .3)/40);

          boids[i].translateY(-.1);

          // if (i == 2) {
          //   console.log("X: " +boids[i].position.x);
          //   console.log("Y: " +boids[i].position.y);
          //   console.log("Z: " +boids[i].position.z);
          // }
      };

      renderer.render(scene, camera);
      //camera.rotateY(Math.PI/1720);
      //camera.translateX(Math.PI/180);

      // if (controls.moveForward) {
      //   console.log("moving forward");
      //   camera.translateZ(-Math.PI/180);
      // }

      controls.update(clock.getDelta());


    }
    function updateControls() {
      controls.update();
    }

    clock = new THREE.Clock();

    // loader.load('www.jombooth.com/repo/models/flying_boid.dae');
    // loader.load('www.jombooth.com/repo/models/low_poly_plane.dae');
    // loader.load('www.jombooth.com/repo/models/skyboxes.dae');

    geo = new THREE.SphereGeometry(1, 25, 25);
    var sphere = new THREE.Mesh(geo, new THREE.MeshPhongMaterial({color: 0x00ff00}));
    sphere.position.set(2.5, -1, 0);

    geo = new THREE.BoxGeometry(2,2,2);
    var cube = new THREE.Mesh(geo,new THREE.MeshPhongMaterial({color: 0x0000ff })   );
    cube.position.set(0, 1, 0);

    var camera = new THREE.PerspectiveCamera(  45, 1024/500,0.1, 100000);
    camera.position.z = 10;
    camera.position.y = 1;

    controls = new THREE.FirstPersonControls( camera );
    controls.movementSpeed = 10;
    controls.lookSpeed = .05;
    // controls.addEventListener( 'change', updateControls );

    var boids = [];
    var boidbox = new THREE.Object3D();

    for(var i = 0; i < numBoids; i++) {
      loader.load('low-poly-plane.dae', function(result) {
        var idx = boids.length;
        boids[idx] = result.scene;
        boids[idx].rotation.x = -Math.PI/2;
        boids[idx].position.x = (Math.random() * 20.0);
        boids[idx].position.y = (Math.random() * 20.0);
        boids[idx].position.z = (Math.random() * 20.0);
        boidbox.add(boids[idx]);
      });
    }
    boidbox.position.z = 0;

    geo = new THREE.PlaneGeometry(0, 0);
    var floor = new THREE.Mesh(geo, new THREE.MeshBasicMaterial({color : 0xcfcfcf}));
    floor.material.side = THREE.DoubleSide;
    floor.rotation.x = Math.PI/2;
    floor.position.y = -2;
    floor.receiveShadow = true;

    var floor_;

    loader.load('skybox2.dae', function(result) {
      floor_ = result.scene;
      floor_.rotation.x = -Math.PI;
      floor_.scale.x = floor_.scale.y = floor_.scale.z = 1;
      floor.add(floor_);
    });

    var light = new THREE.DirectionalLight(0xe0e0e0);
    light.position.set(5,2,5).normalize();

    var light2 = new THREE.DirectionalLight(0xe0e0e0);
    light2.position.set(-5,-2,5).normalize();

    var light3 = new THREE.DirectionalLight(0xe0e0e0);
    light3.position.set(5,-2,-5).normalize();

    var light4 = new THREE.DirectionalLight(0xe0e0e0);
    light4.position.set(-5,2,-5).normalize();

    var scene = new THREE.Scene();
    scene.add(floor);
    scene.add(boidbox);
    scene.add(light);
    scene.add(light2);
    scene.add(light3);
    scene.add(light4);
    scene.add(new THREE.AmbientLight(0x101010));

    var div = document.getElementById("shapecanvas2");

    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(1280,900);
    renderer.setClearColor(0x000000, 1);
    renderer.shadowMapEnabled = true;
    div.appendChild( renderer.domElement );

    animate();

  }

</script>

</head>
<body onload="draw3D();">
  <center>
  <span id="shapecanvas2" style="border: none;" width="1280" height="900"></span>
  </center>
  <br/>
  </body>

</html>
